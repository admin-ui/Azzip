var popUpCal={selectedDay:0,selectedMonth:0,selectedYear:0,selectedHour:0,selectedMinute:0,clearText:"\u6e05\u7a7a",closeText:"\u5173\u95ed",prevText:"&lt;\u4e0a\u6708",nextText:"\u4e0b\u6708&gt;",currentText:"\u4eca\u5929",currentTimeText:"\u73b0\u5728",appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,dayNames:"\u65e5\u4e00\u4e8c\u4e09\u56db\u4e94\u516d".split(""),monthNames:"1\u6708 2\u6708 3\u6708 4\u6708 5\u6708 6\u6708 7\u6708 8\u6708 9\u6708 10\u6708 11\u6708 12\u6708".split(" "),
dateFormat:"YMD-",yearRange:"-10:+10",changeMonth:!0,changeYear:!0,firstDay:0,changeFirstDay:!1,showOtherMonths:!1,minDate:null,maxDate:null,speed:0,autoPopUp:"focus",closeAtTop:!0,customDate:null,fieldSettings:null,timeSeparators:[" ",":"],showTimeSelect:!0,ie6:!!window.ActiveXObject&&!window.XMLHttpRequest,formatDate:function(a,b,c,f,g){b++;for(var d="",e=0;3>e;e++)d+=this.dateFormat.charAt(3)+("D"==this.dateFormat.charAt(e)?(10>a?"0":"")+a:"M"==this.dateFormat.charAt(e)?(10>b?"0":"")+b:"Y"==this.dateFormat.charAt(e)?
c:"?");this.timeSeparators&&(1<this.timeSeparators.length&&this.timeSeparators[0]&&null!=f&&null!=g)&&(d+=this.timeSeparators[0]+this.hourString(f)+this.timeSeparators[1]+(10<=g?g:"0"+g),4==this.timeSeparators.length&&12>f?d+=this.timeSeparators[2]:4==this.timeSeparators.length&&12<=f&&(d+=this.timeSeparators[3]));return d.substring(1)},parseDate:function(a){var b,c,f,g;if(this.timeSeparators&&1<this.timeSeparators.length){a=a.split(this.timeSeparators[0]);for(c=0;c<a.length;)a[c]?c++:a.splice(c,
1);b=0<a.length?a[0].split(this.dateFormat.charAt(3)):[];var d=1<a.length?a[1].split(this.timeSeparators[1]):[]}else b=a.split(this.dateFormat.charAt(3)),d=null;3==b.length?(c=parseInt(b[this.dateFormat.indexOf("D")],10),isNaN(c)&&(c=(new Date).getDate(),validDate=!1),a=parseInt(b[this.dateFormat.indexOf("M")],10)-1,isNaN(a)&&(a=(new Date).getMonth(),validDate=!1),b=parseInt(b[this.dateFormat.indexOf("Y")],10),isNaN(b)&&(b=(new Date).getFullYear(),validDate=!1)):(c=(new Date).getDate(),a=(new Date).getMonth(),
b=(new Date).getFullYear(),validDate=!1);this.timeSeparators&&1<this.timeSeparators.length&&this.timeSeparators[0]?(null!=d&&2==d.length?(f=parseInt(d[0],10),isNaN(f)&&(f=(new Date).getHours(),validDate=!1),2<this.timeSeparators.length?d[1].toLowerCase().indexOf(this.timeSeparators[2].toLowerCase())==d[1].length-this.timeSeparators[2].length?(12==f&&(f=0),g=parseInt(d[1].substring(0,d[1].length-this.timeSeparators[2].length),10)):d[1].toLowerCase().indexOf(this.timeSeparators[3].toLowerCase())==d[1].length-
this.timeSeparators[2].length?(12>f&&(f+=12),g=parseInt(d[1].substring(0,d[1].length-this.timeSeparators[1].length),10)):(g=(new Date).getMinutes(),validDate=!1):g=parseInt(d[1],10)):(f=(new Date).getHours(),g=(new Date).getMinutes(),validDate=!1),isNaN(g)&&(g=(new Date).getMinutes(),validDate=!1),g=new Date(b,a,c,f,g)):(isNaN(g)&&((new Date).getMinutes(),validDate=!1),g=new Date(b,a,c));validDate||(g.textInvalid=!0);return g},setDateFromField:function(){var a=this.parseDate(this.input.val());this.currentDay=
a.getDate();this.currentMonth=a.getMonth();this.currentYear=a.getFullYear();this.timeSeparators&&(1<this.timeSeparators.length&&this.timeSeparators[0])&&(this.currentHour=a.getHours(),this.currentMinute=a.getMinutes());this.selectedDay=this.currentDay;this.selectedMonth=this.currentMonth;this.selectedYear=this.currentYear;this.currentHour&&this.currentMinute&&(this.selectedHour=this.currentHour,this.selectedMinute=this.currentMinute);this.adjustDate(0,"D",!0)},hourString:function(a){return 4==this.timeSeparators.length?
0==a?"12":12<a?""+(a-12):""+a:""+a},selectDate:function(a){a||(a=this.input);this.hideCalendar(this.speed);var b="yes"==this.input.data("calendar.showTime")?this.timeSeparators:[];b&&1<b.length?a.val(this.formatDate(this.selectedDay,this.selectedMonth,this.selectedYear,this.selectedHour,this.selectedMinute)):a.val(this.formatDate(this.selectedDay,this.selectedMonth,this.selectedYear))},showCalendar:function(){this.popUpShowing=!0;var a="",b;if((b="yes"==this.input.data("calendar.showTime")?this.timeSeparators:
[])&&1<b.length){a+='<div id="calendar_time"><select id="calendar_hour">';if(4==b.length)for(var a=12==this.selectedHour||0==this.selectedHour?a+'<option value="12" selected="selected">12</option>':a+'<option value="12">12</option>',c=1;12>c;c++)a=this.selectedHour==c||12==c&&0==this.selectedHour||c+12==this.selectedHour?a+('<option value="'+c+'" selected="selected">'+c+"</option>"):a+('<option value="'+c+'">'+c+"</option>");else for(c=0;24>c;c++)a=this.selectedHour==c?a+('<option value="'+c+'" selected="selected">'+
c+"</option>"):a+('<option value="'+c+'">'+c+"</option>");a+="</select>"+b[1]+'<select id="calendar_minute">';for(c=0;59>c;c++)a=this.selectedMinute==c?a+('<option value="'+c+'" selected="selected">'+(10<=c?c:"0"+c)+"</option>"):a+('<option value="'+c+'">'+(10<=c?c:"0"+c)+"</option>");a+="</select>";4==b.length&&(a=a+' <select id="calendar_ampm">'+('<option value="AM"'+(12>this.selectedHour?' selected="selected"':"")+">"+b[2]+"</option>"),a+='<option value="PM"'+(12<=this.selectedHour?' selected="selected"':
"")+">"+b[3]+"</option>",a+="</select>")}b='<div id="calendar_control"><a id="calendar_prev">'+this.prevText+'</a><a id="calendar_next">'+this.nextText+'</a><a id="calendar_current">'+(b&&1<b.length?this.currentTimeText:this.currentText)+'</a><a id="calendar_close">'+this.closeText+'</a><a id="calendar_clear">'+this.clearText+"</a></div>";b+='<table id="calendar" cellpadding="0" cellspacing="0"><thead><tr class="calendar_titleRow">';for(var f=0;7>f;f++)b+="<td>"+(this.changeFirstDay?"<a>":"")+this.dayNames[(f+
this.firstDay)%7]+(this.changeFirstDay?"</a>":"")+"</td>";b+="</tr></thead><tbody>";f=this.getDaysInMonth(this.selectedYear,this.selectedMonth);this.selectedDay=Math.min(this.selectedDay,f);for(var g=(this.getFirstDayOfMonth(this.selectedYear,this.selectedMonth)-this.firstDay+7)%7,c=new Date(this.currentYear,this.currentMonth,this.currentDay),d=new Date(this.selectedYear,this.selectedMonth,this.selectedDay),e=new Date(this.selectedYear,this.selectedMonth,1-g),g=Math.ceil((g+f)/7),h=new Date,h=new Date(h.getFullYear(),
h.getMonth(),h.getDate()),l=0;l<g;l++){b+='<tr class="calendar_daysRow">';for(f=0;7>f;f++){var m=this.customDate?this.customDate(e):[!0,""],k=e.getMonth()!=this.selectedMonth,n=k||!m[0]||this.minDate&&e<this.minDate||this.maxDate&&e>this.maxDate;b+='<td class="calendar_daysCell'+(5<=(f+this.firstDay+6)%7?" calendar_weekEndCell":"")+(k?" calendar_otherMonth":"")+(e.getTime()==d.getTime()?" calendar_daysCellOver":"")+(n?" calendar_unselectable":"")+(!k||this.showOtherMonths?" "+m[1]:"")+'"'+(e.getTime()==
c.getTime()?' id="calendar_currentDay"':e.getTime()==h.getTime()?' id="calendar_today"':"")+">"+(k?this.showOtherMonths?e.getDate():"&nbsp;":n?e.getDate():"<a>"+e.getDate()+"</a>")+"</td>";e.setDate(e.getDate()+1)}b+="</tr>"}b+='</tbody></table>\x3c!--[if lte IE 6.5]><iframe src="javascript:false;" id="calendar_cover"></iframe><![endif]--\x3e'+(this.closeAtTop?"":'<div id="calendar_control"><a id="calendar_clear">'+this.clearText+'</a><a id="calendar_close">'+this.closeText+"</a></div>");b+='<div id="calendar_header">';
if(this.changeYear){c=this.yearRange.split(":");e=d=0;2!=c.length?(d=this.selectedYear-10,e=this.selectedYear+10):"+"==c[0].charAt(0)||"-"==c[0].charAt(0)?(d=this.selectedYear+parseInt(c[0]),e=this.selectedYear+parseInt(c[1])):(d=parseInt(c[0]),e=parseInt(c[1]));d=this.minDate?Math.max(d,this.minDate.getFullYear()):d;e=this.maxDate?Math.min(e,this.maxDate.getFullYear()):e;for(b+='<select id="calendar_newYear">';d<=e;d++)b+='<option value="'+d+'"'+(d==this.selectedYear?' selected="selected"':"")+">"+
d+"\u5e74</option>";b+="</select>"}else b+=this.selectedYear;if(this.changeMonth){c=this.minDate&&this.minDate.getFullYear()==this.selectedYear;d=this.maxDate&&this.maxDate.getFullYear()==this.selectedYear;b+='<select id="calendar_newMonth">';for(e=0;12>e;e++)(!c||e>=this.minDate.getMonth())&&(!d||e<=this.maxDate.getMonth())&&(b+='<option value="'+e+'"'+(e==this.selectedMonth?' selected="selected"':"")+">"+this.monthNames[e]+"</option>");b+="</select>"}else b+=this.monthNames[this.selectedMonth]+
"&nbsp;";b+="</div>"+a;$("#calendar_div").empty().append(b).show(this.speed);this.input[0].focus();this.setupActions()},init:function(){this.popUpShowing=!1;this.lastInput=null;this.disabledInputs=[];$("body").append('<div id="calendar_div"></div>');$(document).mousedown(popUpCal.checkExternalClick)},showFor:function(a){a=a.nodeName&&"input"==a.nodeName.toLowerCase()?a:this;"input"!=a.nodeName.toLowerCase()&&(a=$("../input",a)[0]);if(popUpCal.lastInput!=a){for(var b=0;b<popUpCal.disabledInputs.length;b++)if(popUpCal.disabledInputs[b]==
a)return;popUpCal.input=$(a);popUpCal.input._showTime=this.showTimeSelect;popUpCal.hideCalendar();popUpCal.lastInput=a;popUpCal.setDateFromField();popUpCal.setPos(a,$("#calendar_div"));$.extend(popUpCal,popUpCal.fieldSettings?popUpCal.fieldSettings(a):{});popUpCal.showCalendar()}},doKeyDown:function(a){if(popUpCal.popUpShowing)switch(a.keyCode){case 9:popUpCal.hideCalendar();break;case 13:popUpCal.selectDate();break;case 27:popUpCal.hideCalendar(popUpCal.speed);break;case 33:popUpCal.adjustDate(-1,
a.ctrlKey?"Y":"M");break;case 34:popUpCal.adjustDate(1,a.ctrlKey?"Y":"M");break;case 35:a.ctrlKey&&$("#calendar_clear").click();break;case 36:a.ctrlKey&&$("#calendar_current").click();break;case 37:a.ctrlKey&&popUpCal.adjustDate(-1,"D");break;case 38:a.ctrlKey&&popUpCal.adjustDate(-7,"D");break;case 39:a.ctrlKey&&popUpCal.adjustDate(1,"D");break;case 40:a.ctrlKey&&popUpCal.adjustDate(7,"D")}else 36==a.keyCode&&a.ctrlKey&&popUpCal.showFor(this)},doKeyPress:function(a){a=String.fromCharCode(void 0==
a.charCode?a.keyCode:a.charCode);return" ">a||a==popUpCal.dateFormat.charAt(3)||"0"<=a&&"9">=a},connectCalendar:function(a){a=$(a);a.after('<span class="calendar_append">'+this.appendText+"</span>");"focus"!=this.autoPopUp&&"both"!=this.autoPopUp||a.focus(this.showFor);if("button"==this.autoPopUp||"both"==this.autoPopUp)a.wrap('<span class="calendar_wrap"></span>').after(this.buttonImageOnly?'<img class="calendar_trigger" src="'+this.buttonImage+'" alt="'+this.buttonText+'" title="'+this.buttonText+
'"/>':'<button class="calendar_trigger">'+(""!=this.buttonImage?'<img src="'+this.buttonImage+'" alt="'+this.buttonText+'" title="'+this.buttonText+'"/>':this.buttonText)+"</button>"),$((this.buttonImageOnly?"img":"button")+".calendar_trigger",a.parent("span")).click(this.showFor);a.keydown(this.doKeyDown).keypress(this.doKeyPress)},enableFor:function(a){a=a.jquery?a:$(a);a.each(function(){this.disabled=!1;$("../button.calendar_trigger",this).each(function(){this.disabled=!1});$("../img.calendar_trigger",
this).each(function(){$(this).css("opacity","1.0")});var a=this;popUpCal.disabledInputs=$.map(popUpCal.disabledInputs,function(c){return c==a?null:c})});return!1},disableFor:function(a){a=a.jquery?a:$(a);a.each(function(){this.disabled=!0;$("../button.calendar_trigger",this).each(function(){this.disabled=!0});$("../img.calendar_trigger",this).each(function(){$(this).css("opacity","0.5")});var a=this;popUpCal.disabledInputs=$.map(popUpCal.disabledInputs,function(c){return c==a?null:c});popUpCal.disabledInputs[popUpCal.disabledInputs.length]=
this});return!1},setupActions:function(){this.timeSeparators&&1<this.timeSeparators.length&&($("#calendar_hour").change(function(){popUpCal.selecting=!1;popUpCal.selectedHour=this.options[this.selectedIndex].value-0;if(4==popUpCal.timeSeparators.length){var a=$("#calendar_ampm").val();"AM"==a&&12==popUpCal.selectedHour?popUpCal.selectedHour=0:"PM"==a&&12!=popUpCal.selectedHour&&(popUpCal.selectedHour+=12)}popUpCal.adjustDate();popUpCal.input.val(popUpCal.formatDate(popUpCal.selectedDay,popUpCal.selectedMonth,
popUpCal.selectedYear,popUpCal.selectedHour,popUpCal.selectedMinute))}).click(this.selectMonthYear),$("#calendar_minute").change(function(){popUpCal.selecting=!1;popUpCal.selectedMinute=this.options[this.selectedIndex].value-0;popUpCal.adjustDate();popUpCal.input.val(popUpCal.formatDate(popUpCal.selectedDay,popUpCal.selectedMonth,popUpCal.selectedYear,popUpCal.selectedHour,popUpCal.selectedMinute))}).click(this.selectMonthYear),$("#calendar_ampm").change(function(){popUpCal.selecting=!1;if(4==popUpCal.timeSeparators.length){var a=
$("#calendar_ampm").val();"AM"==a&&12<popUpCal.selectedHour?popUpCal.selectedHour-=12:"PM"==a&&12>popUpCal.selectedHour?popUpCal.selectedHour+=12:"PM"==a&&12==popUpCal.selectedHour?popUpCal.selectedHour=12:"AM"==a&&12==popUpCal.selectedHour&&(popUpCal.selectedHour=0)}popUpCal.adjustDate();popUpCal.input.val(popUpCal.formatDate(popUpCal.selectedDay,popUpCal.selectedMonth,popUpCal.selectedYear,popUpCal.selectedHour,popUpCal.selectedMinute))}));$("#calendar_clear").click(function(){popUpCal.clearDate()});
$("#calendar_close").click(function(){popUpCal.hideCalendar(popUpCal.speed)});$("#calendar_prev").click(function(){popUpCal.adjustDate(-1,"M");popUpCal.input.val(popUpCal.formatDate(popUpCal.selectedDay,popUpCal.selectedMonth,popUpCal.selectedYear,popUpCal.selectedHour,popUpCal.selectedMinute))});$("#calendar_next").click(function(){popUpCal.adjustDate(1,"M");popUpCal.input.val(popUpCal.formatDate(popUpCal.selectedDay,popUpCal.selectedMonth,popUpCal.selectedYear,popUpCal.selectedHour,popUpCal.selectedMinute))});
$("#calendar_current").click(function(){popUpCal.selectedDay=(new Date).getDate();popUpCal.selectedMonth=(new Date).getMonth();popUpCal.selectedYear=(new Date).getFullYear();popUpCal.adjustDate();var a="yes"==popUpCal.input.data("calendar.showTime")?popUpCal.timeSeparators:[];a&&1<a.length?popUpCal.input.val(popUpCal.formatDate(popUpCal.selectedDay,popUpCal.selectedMonth,popUpCal.selectedYear,popUpCal.selectedHour,popUpCal.selectedMinute)):popUpCal.input.val(popUpCal.formatDate(popUpCal.selectedDay,
popUpCal.selectedMonth,popUpCal.selectedYear));popUpCal.ie6||popUpCal.hideCalendar(popUpCal.speed)});$("#calendar_newMonth").change(function(){popUpCal.selecting=!1;popUpCal.selectedMonth=this.options[this.selectedIndex].value-0;popUpCal.adjustDate();popUpCal.input.val(popUpCal.formatDate(popUpCal.selectedDay,popUpCal.selectedMonth,popUpCal.selectedYear,popUpCal.selectedHour,popUpCal.selectedMinute))}).click(this.selectMonthYear);$("#calendar_newYear").change(function(){popUpCal.selecting=!1;popUpCal.selectedYear=
this.options[this.selectedIndex].value-0;popUpCal.adjustDate();popUpCal.input.val(popUpCal.formatDate(popUpCal.selectedDay,popUpCal.selectedMonth,popUpCal.selectedYear,popUpCal.selectedHour,popUpCal.selectedMinute))}).click(this.selectMonthYear);$(".calendar_titleRow a").click(function(){for(var a=0;7>a;a++)popUpCal.dayNames[a]==this.firstChild.nodeValue&&(popUpCal.firstDay=a);popUpCal.showCalendar()});$(".calendar_daysRow td a").hover(function(){$(this).addClass("calendar_daysCellOver")},function(){$(this).removeClass("calendar_daysCellOver")});
$(".calendar_daysRow td a").click(function(){popUpCal.selectedDay=$(this).html();popUpCal.selectDate()})},hideCalendar:function(a){this.popUpShowing&&($("#calendar_div").hide(a),this.popUpShowing=!1,this.lastInput=null,popUpCal.input.blur())},scrollPos:function(){var a={left:0,top:0,width:0,height:0},b=document;self.innerHeight?(a.height=self.innerHeight,a.width=self.innerWidth,a.left=self.pageXOffset,a.top=self.pageYOffset):popUpCal.ie6?(a.height=b.documentElement.clientHeight,a.width=b.documentElement.clientWidth,
a.top=b.documentElement.scrollTop,a.left=b.documentElement.scrollLeft):b.body&&(a.height=b.body.clientHeight,a.width=b.body.clientWidth,a.left=b.body.scrollLeft,a.top=b.body.scrollTop);return a},selectMonthYear:function(){popUpCal.selecting&&popUpCal.input[0].focus();popUpCal.selecting=!popUpCal.selecting},clearDate:function(){this.hideCalendar(this.speed);this.input.val("")},checkExternalClick:function(a){if(popUpCal.popUpShowing){a=a.target;for(var b=$("#calendar_div")[0];a&&a!=b&&"calendar_trigger"!=
a.className;)a=a.parentNode;a||popUpCal.hideCalendar()}},noWeekends:function(a){a=a.getDay();return[0<a&&6>a,""]},adjustDate:function(a,b,c){a=this.timeSeparators&&1<this.timeSeparators.length?new Date(this.selectedYear+("Y"==b?a:0),this.selectedMonth+("M"==b?a:0),this.selectedDay+("D"==b?a:0),this.selectedHour+("H"==b?a:0),this.selectedMinute+("MIN"==b?a:0)):new Date(this.selectedYear+("Y"==b?a:0),this.selectedMonth+("M"==b?a:0),this.selectedDay+("D"==b?a:0));a=this.minDate&&a<this.minDate?this.minDate:
a;a=this.maxDate&&a>this.maxDate?this.maxDate:a;this.selectedDay=a.getDate();this.selectedMonth=a.getMonth();this.selectedYear=a.getFullYear();this.timeSeparators&&1<this.timeSeparators.length&&(this.selectedHour=a.getHours(),this.selectedMinute=a.getMinutes());c||this.showCalendar()},getDaysInMonth:function(a,b){return 32-(new Date(a,b,32)).getDate()},getFirstDayOfMonth:function(a,b){return(new Date(a,b,1)).getDay()},setPos:function(a,b){var c=this.findPos(a);popUpCal.scrollPos();b.css("position",
"absolute").css("left",c[0]+"px").css("top",c[1]+a.offsetHeight-1+"px")},findPos:function(a){var b=curtop=0;if(a.offsetParent)for(b=a.offsetLeft,curtop=a.offsetTop;a=a.offsetParent;){var c=b,b=b+a.offsetLeft;0>b&&(b=c);curtop+=a.offsetTop}return[b,curtop]}};$.fn.calendar=function(a){var b=!1;a&&a.showTimeSelect&&(b=a.showTimeSelect,delete a.showTimeSelect);$.extend(popUpCal,a||{});return this.each(function(){"input"==this.nodeName.toLowerCase()&&($(this).data("calendar.showTime",b?"yes":"no"),popUpCal.connectCalendar(this))})};
$(function(){popUpCal.init()});
