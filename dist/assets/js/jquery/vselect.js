(function(j,l,m){function q(a){return"undefined"==typeof a}function p(a){return"function"==typeof a}var x=!!m.ActiveXObject&&!m.XMLHttpRequest,k={multipleJointer:"|^|",speed:"fast",shadow:!1},g={select:"vselect",linkOn:"vselect-link-on",panel:"vselect-panel",shadow:"vselect-shadow",tab:"vselect-panel-tab",tabOn:"vselect-panel-tab-on",tabHover:"vselect-panel-tab-hover"},v={selectedValue:null,grouplessLabel:"\u5176\u4ed6",direction:"center",styleString:null,width:null,maxHeight:320,maxColumn:5,maxTop:0},
t=1,u=null,r=[],w=!1,f={init:function(a){w||(w=!0,j(m).resize(function(){if(!(1>r.length)){var a,b,e;for(a=0;a<r.length;a++)b=r[a],e=b._panel,b=f.panelPosition(b,e,f.options(b)),e.css({left:b.x,top:b.y})}}),j(l).click(function(a){a=j(a.srcElement?a.srcElement:a.target);var b;!a.hasClass(g.panel)&&(!a.hasClass(g.select)&&!a.hasClass(g.tab))&&(a=a.parent(),!a.hasClass(g.select)&&!a.hasClass(g.tab)&&(a=a.parent().parent(),(!a.hasClass(g.panel)||!(b=l.getElementById(a.attr("id").slice(0,-5)))||!b||!("undefined"!=
typeof b._multiple&&b._multiple))&&f.hideAll()))}).keyup(function(a){a||(a=m.event);27==(a.keyCode?a.keyCode:a.which)&&f.hideAll()}),j("body:first").append('<div class="'+g.shadow+'" id="__'+g.select+'_shadow" style="display:none">&nbsp;</div>'),u=j("#__"+g.select+"_shadow"));a=a||{};for(var b in v)"undefined"==typeof a[b]&&(a[b]=v[b]);return this.each(function(){f.selectInit.call(this,a)})},selectInit:function(a){var b,c,d,e;if(this.name||this.id)e=j(this).val(),d=0<j(this).find("optgroup").length,
c=f._createDom(this,a,d),b=c[0],b._options=a,b._panel=j("#__"+g.select+(t-1)+"panel"),b._value=c.find("input:first"),b._caption=c.find("em:first"),0<a.width&&c.css("width",a.width),b._selectWidth=c.width(),b._group=d,b._multiple=this.multiple,b._initSelectedIndex=this.options.selectedIndex,b._origMaxHeight=a.maxHeight,b._column=1,d?(b._tab=b._panel.find("div."+g.tab+":first"),f.panelInitWithOptgroup(b,b._panel,a),f.panelArrangeWithOptgroup(b,b._panel,a)):(f.panelInit(b,b._panel,a),f.panelArrange(b,
b._panel,a)),c.click(f.selectClick),j(this).remove(),f.setValue.call(b,null===a.selectedValue?e:a.selectedValue)},panelInit:function(a,b){var c,d=j(b).find("a");for(c=0;c<d.length;c++)q(d[c].getAttribute("rel"))||(d[c].onclick=function(b){f.itemClick.call(a,b,this.getAttribute("rel"))})},panelArrange:function(a,b,c){var d=f.borderSize(b),d=j(a).outerWidth()-d.width,e=1;b.find("ul").hide().eq(0).css("display","block");for(b.css({width:d,height:"auto"}).find("li").css("width",d);(a._panelHeight=b.height())>
c.maxHeight;)if(++e<=c.maxColumn)b.css("width",d*e);else{c.maxHeight=b.height();break}a._column=e;a._showWidth=b.css("width")},panelInitWithOptgroup:function(a,b,c){b.find("div."+g.tab+" em").hover(function(){j(this).addClass(g.tabHover)},function(){j(this).removeClass(g.tabHover)}).each(function(b){this.onclick=function(){f.panelTabClick(a,b)}});b.find("> ul").each(function(){f.panelInit(a,this,c)})},panelArrangeWithOptgroup:function(a,b,c){var d=f.borderSize(b),e=j(a).outerWidth()-d.width,h=b.find("> ul");
1>h.length||(a._panelWidth=0,a._panelHeight=0,a._panelTabWidth=0,a._panelTabHeight=0,gridHeight=b.find("li:first").height(),h.each(function(){var d=j(this),f=1;h.hide();d.css("display","block");b.css({width:e,height:"auto"});for(d.find("li").css("width",e);b.height()>c.maxHeight;)if(++f<=c.maxColumn)b.css("width",e*f);else break;a._panelWidth=Math.max(b.width(),a._panelWidth);a._column=Math.max(f,a._column)}),h.each(function(){var d=j(this),f=1;h.hide();d.css("display","block");b.css({width:a._panelWidth,
height:"auto"});for(d.find("li").css("width",e);b.height()>c.maxHeight;)if(++f<=c.maxColumn)b.css("width",e*f);else{c.maxHeight=b.height();break}a._panelHeight=Math.max(b.height(),a._panelHeight)}),a._showWidth=b.css("width"),f.panelActiveSelectedTab(a))},_createDom:function(a,b,c){var d="",e,h="",s;if(c){e=j(a).find("optgroup");for(c=0;c<e.size();c++)h+="<em>"+(e[c].label||index)+"</em>",d+=f._createBlock(e[c]);0<j(a).find("> option").size()&&(h+="<em>"+b.grouplessLabel+"</em>",d+=f._createBlock(a));
h='<div class="'+g.tab+'">'+h+"</div>"}else d=f._createBlock(a,!0);c=a.id?' id="'+a.id+'" ':"";e=a.name?' name="'+a.name+'" ':"";s=a.getAttribute("title")?' title="'+a.getAttribute("title")+'" ':"";b=b.styleString?' style="'+b.styleString+'" ':"";j(a).after('<a href="javascript:;" class="'+g.select+'" id="__'+g.select+t+'"'+s+b+'><input type="hidden" '+c+e+' value="" /><em></em><i>&#9660;</i></a>');j("body:first").append('<div class="'+g.panel+'" id="__'+g.select+t+'panel" style="display:none">'+
h+d+"</div>");return j(l.getElementById("__"+g.select+t++))},_createBlock:function(a,b){var c="",d=j(a).find("> option"),e;for(e=0;e<d.length;e++)q(d[e].text)&&(d[e].text=d[e].value),c+='<li><a href="javascript:;" rel="'+d[e].value+'">'+d[e].text+"</a></li>";"undefined"!=typeof b&&(b&&1==d.length)&&(c+="<li>&nbsp;</li>");return"<ul>"+c+"</ul>"},setValue:function(a){var b,c,d=null,e=j(this);f.options(this);var h=this._panel.find("a");if(this._multiple){var s=[],l=[];for(b=0;b<h.length;b++)c=h[b],!q(c.rel)&&
c.rel==a&&(c.className=c.className==g.linkOn?"":g.linkOn),c.className==g.linkOn&&(s.push(c.innerHTML),l.push(c.rel));a=d="";0<l.length&&(d=s.join(","),a=l.join(k.multipleJointer))}else{h.removeClass(g.linkOn);for(b=0;b<h.length;b++)c=h[b],!q(c.rel)&&c.rel==a&&(c.className=g.linkOn,d=c.innerHTML);null===d&&0<h.length&&(a=h[0].rel,d=h[0].innerHTML)}this._caption.html(d);this._value.val(a).attr("rel",d);this._caption.width()+26>this._selectWidth&&e.width(this._caption.width()+26);this._caption.width()+
26<this._selectWidth&&e.width(this._selectWidth);if(this._group){var n={};this._tab.find("em").css("text-decoration","none");this._panel.find("a."+g.linkOn).each(function(){n[j(this).parent().parent().index()-1]=1});for(b in n)this._tab.find("em:eq("+b+")").css("text-decoration","underline")}},selectClick:function(a){f.haltEvent(a);f.hideAll();f.show.call(this)},itemClick:function(a,b,c){var d=f.options(this),e=b!=this._value.val();this._multiple||f.hideAll();f.setValue.call(this,b);if(p(d.click)||
e&&p(d.change))c||f.haltEvent(a),p(d.click)&&d.click.call(this._value,a,b),e&&p(d.change)&&d.change.call(this._value,a,b)},clickValue:function(a){0<this._panel.find("a[rel='"+a+"']").length&&(f.itemClick.call(this,m.event,a,!0),this._tab&&f.panelActiveSelectedTab(this))},panelTabClick:function(a,b){a._panel.find("div."+g.tab).find("em").removeClass(g.tabOn).eq(b).addClass(g.tabOn);a._panel.find("> ul").hide().eq(b).show();a._panel.css({width:a._panelWidth,height:a._panelHeight})},panelActiveSelectedTab:function(a){var b,
c=a._panel.find("> ul");for(b=0;b<c.length&&!(0<c.eq(b).find("a."+g.linkOn).length);b++);b>=c.length&&(b=0);c.hide().eq(b).show();a._tab.find("em").removeClass(g.tabOn).eq(b).addClass(g.tabOn)},panelPosition:function(a,b,c,d){var e=0,h=0,g=0,k=0;self.innerHeight?(k=self.innerHeight,g=self.innerWidth,e=self.pageXOffset,h=self.pageYOffset):x?(k=l.documentElement.clientHeight,g=l.documentElement.clientWidth,h=l.documentElement.scrollTop,e=l.documentElement.scrollLeft):l.body&&(k=l.body.clientHeight,
g=l.body.clientWidth,e=l.body.scrollLeft,h=l.body.scrollTop);var n=j(a);c=f.options(a);var m,p;m=f.borderSize(b);p=parseInt(a._showWidth);a=Math.min(a._panelHeight,c.maxHeight);b=d?b.offset().left:n.offset().left;switch(c.direction){case "top":d=n.offset().top+n.outerHeight()-a-m.height;break;case "bottom":d=n.offset().top;break;default:d=n.offset().top+(n.outerHeight()>>1)-(a>>1)-(m.height>>1)}d<h+c.maxTop&&(d=n.offset().top);d+a>h+k&&(d=n.offset().top+n.outerHeight()-a-m.height);d+a>h+k&&(d=h+k-
a-m.height);b+p>e+g&&(b=e+g-p-m.width);0>b&&(b=0);0>d&&(d=c.maxTop);return{x:b,y:d,w:p,h:a}},show:function(){var a=this,b=j(a),c=f.options(a),d,e=a._panel,h,g;b.blur();e.is(":visible")||(d=f.borderSize(e),e.show().css({height:b.outerHeight()-d.height,left:b.offset().left,top:b.offset().top}),a._group&&e.css("width",a._panelWidth),h=f.panelPosition(a,e,c,!0),g={height:h.h,left:h.x,top:h.y},1<a._column&&(g.width=a._showWidth,e.css("width",b.outerWidth())),"top"==c.direction&&e.css("top",b.offset().top+
1),a._panel.animate(g,k.speed,function(){p(c.show)&&c.show.call(a)}),k.shadow&&u.show().css({width:e.width(),height:b.outerHeight()-d.height,left:b.offset().left,top:b.offset().top}).animate({height:h.h,left:h.x+6,top:h.y+6},k.speed),r.push(a))},hide:function(){var a=this,b=f.options(a),c=j(this),d=this._panel,e=f.borderSize(d),g;g=d.css("z-index");d.css("z-index",g-1);"top"==b.direction&&d.css("top",parseInt(d.css("top"))+1);e={height:c.outerHeight()-e.height,left:c.offset().left,top:c.offset().top};
1<a._column&&(e.width=c.outerWidth());d.animate(e,k.speed,function(){d.hide();d.css("z-index",g);p(b.hide)&&b.hide.call(a)});k.shadow&&u.hide()},hideAll:function(){for(var a;a=r.pop();)f.hide.call(a)},reset:function(a,b){var c=this._panel,d=f.options(this),e="",g,j=0;this._initSelectedIndex=-1;d.maxHeight=this._origMaxHeight;q(b)||(d.selectedValue=b);for(g in a)e+='<li><a href="javascript:;" rel="'+g+'">'+a[g]+"</a></li>",j++;1==j&&(e+="<li>&nbsp;</li>");c.empty().html("<ul>"+e+"</ul>");f.panelInit(this,
c,d);f.panelArrange(this,c,d);f.setValue.call(this,d.selectedValue)},haltEvent:function(a){a=a||m.event;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;return!1},borderSize:function(a){a=j(a);return{width:parseInt(a.css("border-left-width"))+parseInt(a.css("border-right-width")),height:parseInt(a.css("border-top-width"))+parseInt(a.css("border-bottom-width"))}},options:function(a){return a._options?a._options:{}},value:function(){return this._value?this._value.val():this.value},caption:function(){return this._value?
this._value[0].getAttribute("rel"):this.getAttribute("rel")}};j.vselect={config:function(a){return"undefined"==typeof k[a]?void 0:k[a]},setConfig:function(a,b){switch(typeof a){case "object":for(var c in a)k[c]=a[c];return;case "array":for(c=0;c<a.length;c++)k[c]=a[c];return}k[a]=b},style:function(a){return"undefined"==typeof g[a]?void 0:g[a]},setStyle:function(a,b){switch(typeof a){case "object":for(var c in a)g[c]=a[c];return;case "array":for(c=0;c<a.length;c++)g[c]=a[c];return}g[a]=b},hide:f.hideAll};
j.fn.extend({vselect:function(){return f.init.apply(this,arguments)},vselectShow:function(){var a=arguments;return this.each(function(){f.show.apply(this._panel?this:j(this).parent()[0],a)})},vselectHide:function(){var a=arguments;return this.each(function(){f.hide.apply(this._panel?this:j(this).parent()[0],a)})},vselectValue:function(){return 1>this.size()?null:f.value.apply(this[0])},vselectSetValue:function(a){return 1>this.size()?null:f.setValue.call(this.parent()[0],a)},vselectClickValue:function(a){return 1>
this.size()?null:f.clickValue.call(this.parent()[0],a)},vselectCaption:function(){return 1>this.size()?null:f.caption.call(this[0])},vselectReset:function(){var a=arguments;return this.each(function(){f.reset.apply(this._panel?this:j(this).parent()[0],a)})}})})(jQuery,document,window);
